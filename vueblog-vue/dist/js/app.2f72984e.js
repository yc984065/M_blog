(function(e){function t(t){for(var s,i,n=t[0],l=t[1],c=t[2],u=0,g=[];u<n.length;u++)i=n[u],Object.prototype.hasOwnProperty.call(r,i)&&r[i]&&g.push(r[i][0]),r[i]=0;for(s in l)Object.prototype.hasOwnProperty.call(l,s)&&(e[s]=l[s]);d&&d(t);while(g.length)g.shift()();return o.push.apply(o,c||[]),a()}function a(){for(var e,t=0;t<o.length;t++){for(var a=o[t],s=!0,n=1;n<a.length;n++){var l=a[n];0!==r[l]&&(s=!1)}s&&(o.splice(t--,1),e=i(i.s=a[0]))}return e}var s={},r={app:0},o=[];function i(t){if(s[t])return s[t].exports;var a=s[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=e,i.c=s,i.d=function(e,t,a){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(a,s,function(t){return e[t]}.bind(null,s));return a},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/";var n=window["webpackJsonp"]=window["webpackJsonp"]||[],l=n.push.bind(n);n.push=t,n=n.slice();for(var c=0;c<n.length;c++)t(n[c]);var d=l;o.push([0,"chunk-vendors"]),a()})({0:function(e,t,a){e.exports=a("56d7")},"059d":function(e,t,a){"use strict";a("e590")},1544:function(e,t,a){},1730:function(e,t,a){"use strict";a("84ab")},"1b27":function(e,t,a){"use strict";a("a3e3")},2173:function(e,t,a){"use strict";a("8b01")},3765:function(e,t,a){},"56d7":function(e,t,a){"use strict";a.r(t);var s=a("2b0e"),r=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},o=[],i=(a("6b01"),a("2877")),n={},l=Object(i["a"])(n,r,o,!1,null,null,null),c=l.exports,d=a("8c4f"),u=function(){var e=this,t=e._self._c;return t("div",[t("el-container",[t("el-header",[t("img",{staticClass:"mlogo",attrs:{src:"https://www.markerhub.com/dist/images/logo/markerhub-logo.png",alt:""}})]),t("el-main",[t("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"用户名",prop:"username"}},[t("el-input",{model:{value:e.ruleForm.username,callback:function(t){e.$set(e.ruleForm,"username",t)},expression:"ruleForm.username"}})],1),t("el-form-item",{attrs:{label:"密码",prop:"password"}},[t("el-input",{attrs:{type:"password"},model:{value:e.ruleForm.password,callback:function(t){e.$set(e.ruleForm,"password",t)},expression:"ruleForm.password"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v("登录")]),t("el-button",{on:{click:function(t){return e.resetForm("ruleForm")}}},[e._v("重置")])],1),t("el-form-item",[t("el-link",{attrs:{type:"primary",href:"/register"}},[e._v("没有账号？立即注册")])],1),t("el-form-item",[t("el-button",{on:{click:e.goHome}},[e._v("返回主页")])],1)],1)],1)],1)],1)},g=[],m=(a("14d9"),{name:"Login",data(){return{ruleForm:{username:"Mrblue",password:"984065220"},rules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:15,message:"长度在 3 到 15 个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},loading:!1}},methods:{submitForm(e){this.$refs[e].validate(e=>{if(!e)return console.log("登录表单校验失败"),!1;this.$axios.post("/login",this.ruleForm).then(e=>{if(200===e.data.code&&e.headers["authorization"]){const t=e.headers["authorization"],a=e.data.data;console.log("登录成功，用户信息:",a),this.$store.commit("SET_TOKEN",t),this.$store.commit("SET_USERINFO",a),a&&"admin"===a.role?(this.$message.success("管理员登录成功！正在跳转到管理后台..."),this.$router.push({name:"AdminDashboard"})):(this.$message.success("登录成功！"),this.$router.push({name:"UserPage"}))}else this.$message.error(e.data.msg||"登录失败，请检查您的凭据")}).catch(e=>{var t;console.error("登录请求失败:",e);const a=(null===(t=e.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.msg)||e.message||"登录请求异常";this.$message.error(a)})})},resetForm(e){this.$refs[e].resetFields()},goHome(){this.$store.getters.getUser;this.$router.push({name:"UserPage"})}}}),h=m,p=(a("8b9a"),Object(i["a"])(h,u,g,!1,null,"8964a766",null)),f=p.exports,b=function(){var e=this,t=e._self._c;return t("div",{staticClass:"mcontainer"},[t("Header"),t("div",{staticClass:"main-content"},[t("div",{staticClass:"filter-container"},[t("el-input",{staticClass:"search-input",attrs:{placeholder:"🔍 搜索博客标题...",clearable:""},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch.apply(null,arguments)}},model:{value:e.searchQuery,callback:function(t){e.searchQuery=t},expression:"searchQuery"}}),t("el-button",{staticClass:"search-button",attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.handleSearch}},[e._v(" 搜索 ")]),t("el-select",{staticClass:"select-box",attrs:{placeholder:"📂 分类",clearable:""},on:{change:e.handleSearch},model:{value:e.selectedCategory,callback:function(t){e.selectedCategory=t},expression:"selectedCategory"}},e._l(e.categories,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1),t("el-select",{staticClass:"select-box",attrs:{placeholder:"🏷️ 标签",clearable:""},on:{change:e.handleSearch},model:{value:e.selectedTag,callback:function(t){e.selectedTag=t},expression:"selectedTag"}},e._l(e.tags,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1),t("el-button",{staticClass:"reset-button",attrs:{type:"warning",icon:"el-icon-refresh-left"},on:{click:e.resetFilters}},[e._v(" 重置 ")])],1),t("el-timeline",e._l(e.blogs,(function(a){return t("el-timeline-item",{key:a.id,attrs:{timestamp:a.created,placement:"top"}},[t("el-card",{staticClass:"blog-card"},[t("h4",[t("router-link",{attrs:{to:{name:"BlogDetail",params:{blogId:a.id}}}},[e._v(" "+e._s(a.title)+" ")])],1),t("p",[e._v(e._s(a.description))]),a.category?t("p",[t("strong",[e._v("分类：")]),e._v(" "+e._s(a.category.name)+" ")]):e._e(),a.tags&&a.tags.length>0?t("p",[t("strong",[e._v("标签：")]),e._l(a.tags,(function(s,r){return t("span",{key:s.id},[e._v(" "+e._s(s.name)),r<a.tags.length-1?t("span",[e._v(", ")]):e._e()])}))],2):e._e()])],1)})),1),e.searchMode?e._e():t("el-pagination",{staticClass:"pagination",attrs:{background:"",layout:"prev, pager, next","current-page":e.currentPage,"page-size":e.pageSize,total:e.total},on:{"current-change":e.page}})],1)],1)},v=[],y=function(){var e=this,t=e._self._c;return t("div",{staticClass:"m-content"},[t("h3",[e._v("欢迎来到Mrblue的博客")]),t("div",{staticClass:"block"},[t("el-avatar",{attrs:{size:50,src:e.avatarUrl}}),t("div",[e._v(e._s(e.user.username))])],1),t("div",{staticClass:"maction"},[t("span",[t("el-link",{attrs:{underline:!1},on:{click:function(t){return e.navigateTo(e.userHomePageLink)}}},[e._v("主页")])],1),t("el-divider",{attrs:{direction:"vertical"}}),t("span",[t("el-link",{attrs:{type:"success",underline:!1},on:{click:function(t){return e.navigateTo("/blog/add")}}},[e._v("发表博客")])],1),t("el-divider",{attrs:{direction:"vertical"}}),e.hasLogin?e._e():t("span",[t("el-link",{attrs:{type:"primary",underline:!1},on:{click:function(t){return e.navigateTo("/login")}}},[e._v("登录")])],1),e.hasLogin?t("span",[t("el-link",{attrs:{type:"danger",underline:!1},on:{click:e.logout}},[e._v("退出")])],1):e._e()],1)])},w=[],_=a("2f62"),$={name:"Header",computed:{...Object(_["b"])(["getUser","isAdmin"]),user(){return this.getUser||{username:"请先登录",avatar:"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png"}},hasLogin(){return!!this.$store.state.token&&this.getUser&&"undefined"!==typeof this.getUser.id},avatarUrl(){const e=this.user.avatar;return e&&e.startsWith("/uploads/")?"http://localhost:8081"+e:e||"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png"},userHomePageLink(){return this.hasLogin&&this.isAdmin?{name:"AdminDashboard"}:{name:"UserPage"}}},methods:{logout(){this.$axios.get("/logout").then(e=>{this.$store.commit("REMOVE_INFO"),this.$router.push("/login")}).catch(e=>{console.error("退出操作异常:",e),this.$store.commit("REMOVE_INFO"),this.$router.push("/login")})},goToAdminDashboard(){this.$router.push({name:"AdminDashboard"})},navigateTo(e){this.$route.path===e||this.$route.name===e.name&&JSON.stringify(this.$route.params)===JSON.stringify(e.params)||("string"===typeof e||"object"===typeof e&&null!==e)&&this.$router.push(e).catch(e=>{"NavigationDuplicated"!==e.name&&console.error(e)})}}},k=$,x=(a("1b27"),Object(i["a"])(k,y,w,!1,null,"1adb83f1",null)),F=x.exports,C={name:"User",components:{Header:F},data(){return{blogs:[],currentPage:1,total:0,pageSize:5,searchQuery:"",searchMode:!1,searchTimeout:null,categories:[],tags:[],selectedCategory:null,selectedTag:null}},methods:{page(e){this.$axios.get("/blogs",{params:{currentPage:e,pageSize:this.pageSize}}).then(e=>{200===e.data.code&&(this.blogs=e.data.data.records,this.currentPage=e.data.data.current,this.total=e.data.data.total,this.pageSize=e.data.data.size,this.searchMode=!1)}).catch(e=>{console.error("Failed to fetch blogs:",e)})},resetFilters(){this.searchQuery="",this.selectedCategory=null,this.selectedTag=null,this.searchMode=!1,this.page(1)},handleSearch(){clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(()=>{if(!this.searchQuery.trim()&&!this.selectedCategory&&!this.selectedTag)return this.searchMode=!1,void this.page(1);this.searchMode=!0;const e={};this.searchQuery.trim()&&(e.query=this.searchQuery.trim()),null!==this.selectedCategory&&(e.categoryId=this.selectedCategory),null!==this.selectedTag&&(e.tagId=this.selectedTag),this.$axios.get("/blogs/search",{params:e}).then(e=>{200===e.data.code&&(this.blogs=e.data.data)}).catch(e=>{console.error("Failed to search blogs:",e)})},300)},fetchMetaData(){this.$axios.get("/categories").then(e=>{this.categories=e.data.data}),this.$axios.get("/tags").then(e=>{this.tags=e.data.data})}},created(){this.$store.state.userInfo&&this.page(1),this.fetchMetaData()},beforeUnmount(){clearTimeout(this.searchTimeout)}},S=C,I=(a("2173"),Object(i["a"])(S,b,v,!1,null,"3c227bfd",null)),A=I.exports,L=function(){var e=this,t=e._self._c;return t("div",[t("Header"),t("div",{staticClass:"m-content"},[t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.pageLoading,expression:"pageLoading"}],staticClass:"form-loading-container",attrs:{"element-loading-text":"正在加载博客数据，请稍候...","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(255, 255, 255, 0.7)"}},[t("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"标题",prop:"title"}},[t("el-input",{attrs:{placeholder:"请输入博客标题"},model:{value:e.ruleForm.title,callback:function(t){e.$set(e.ruleForm,"title",t)},expression:"ruleForm.title"}})],1),t("el-form-item",{attrs:{label:"摘要",prop:"description"}},[t("el-input",{attrs:{type:"textarea",placeholder:"请输入博客摘要",rows:"3"},model:{value:e.ruleForm.description,callback:function(t){e.$set(e.ruleForm,"description",t)},expression:"ruleForm.description"}})],1),t("el-form-item",{attrs:{label:"分类",prop:"categoryIds"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"",filterable:"",placeholder:"请选择或搜索分类",loading:e.pageLoading},on:{change:e.handleCategoryChange},model:{value:e.ruleForm.categoryIds,callback:function(t){e.$set(e.ruleForm,"categoryIds",t)},expression:"ruleForm.categoryIds"}},e._l(e.categories,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),t("el-form-item",{attrs:{label:"标签",prop:"tagIds"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"",filterable:"","allow-create":"","default-first-option":"",placeholder:"请输入或选择标签，可创建新标签",loading:e.pageLoading},on:{change:e.handleTagChange},model:{value:e.ruleForm.tagIds,callback:function(t){e.$set(e.ruleForm,"tagIds",t)},expression:"ruleForm.tagIds"}},e._l(e.tags,(function(a){return t("el-option",{key:a.id,attrs:{label:a.name,value:a.id}},[t("span",{style:{color:a.color||"#409EFF"}},[e._v(e._s(a.name))])])})),1)],1),t("el-form-item",{attrs:{label:"内容",prop:"content"}},[e.pageLoading&&e.ruleForm.id?t("div",{staticStyle:{"min-height":"500px",display:"flex","align-items":"center","justify-content":"center",border:"1px solid #eee",color:"#999"}},[e._v("内容加载中...")]):t("mavon-editor",{ref:"mdEditor",staticStyle:{"min-height":"500px"},attrs:{toolbars:e.toolbars,placeholder:"开始编写你的博客内容..."},on:{imgAdd:e.handleImageAdd},model:{value:e.ruleForm.content,callback:function(t){e.$set(e.ruleForm,"content",t)},expression:"ruleForm.content"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary",loading:e.submitLoading},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v(" "+e._s(e.ruleForm.id?"更新博客":"发布博客")+" ")]),t("el-button",{on:{click:function(t){return e.resetForm("ruleForm")}}},[e._v("重置内容")]),t("el-button",{attrs:{type:"success",loading:e.aiLoading,disabled:e.pageLoading||!e.ruleForm.content||!e.ruleForm.content.trim(),icon:"el-icon-lightbulb"},on:{click:e.getGemmaSuggestions}},[e._v(" 获取AI建议 ")])],1)],1)],1),t("el-dialog",{attrs:{title:"AI 写作建议 (Gemma 3)",visible:e.dialogVisible,width:"75%",top:"5vh","close-on-click-modal":!1,"append-to-body":""},on:{"update:visible":function(t){e.dialogVisible=t}}},[e.aiLoading?t("div",{staticClass:"loading-spinner"},[t("i",{staticClass:"el-icon-loading"}),e._v(" 正在卖力生成建议，请稍候... ")]):t("div",{staticClass:"ai-suggestions-content"},[t("mavon-editor",{staticStyle:{"min-height":"45vh",border:"1px solid #dcdfe6","border-radius":"4px"},attrs:{subfield:!1,defaultOpen:"preview",toolbarsFlag:!1,editable:!1,boxShadowStyle:"none",previewBackground:"#f8f9fa"},model:{value:e.suggestions,callback:function(t){e.suggestions=t},expression:"suggestions"}})],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("关闭")]),t("el-button",{attrs:{type:"primary",disabled:!e.suggestions||e.suggestions.startsWith("获取建议失败")||e.aiLoading},on:{click:e.applySuggestion}},[e._v("应用建议到正文")])],1)])],1)],1)},O=[],T=(a("e9f5"),a("910d"),a("f665"),a("ab43"),{name:"BlogEdit",components:{Header:F},data(){return{pageLoading:!1,ruleForm:{id:null,title:"",description:"",content:"",categoryIds:[],tagIds:[]},categories:[],tags:[],rules:{title:[{required:!0,message:"请输入标题",trigger:"blur"},{min:3,max:100,message:"长度在 3 到 100 个字符",trigger:"blur"}],description:[{required:!0,message:"请输入摘要",trigger:"blur"},{max:255,message:"摘要长度不能超过 255 个字符",trigger:"blur"}],content:[{required:!0,message:"请输入内容",trigger:"blur"}]},suggestions:"",aiLoading:!1,submitLoading:!1,dialogVisible:!1,toolbars:{bold:!0,italic:!0,header:!0,underline:!0,strikethrough:!0,mark:!0,superscript:!0,subscript:!0,quote:!0,ol:!0,ul:!0,link:!0,imagelink:!0,code:!0,table:!0,fullscreen:!0,readmodel:!0,htmlcode:!0,help:!0,undo:!0,redo:!0,trash:!0,save:!1,navigation:!0,alignleft:!0,aligncenter:!0,alignright:!0,subfield:!0,preview:!0}}},computed:{...Object(_["b"])(["getUser","isAdmin"])},methods:{handleImageAdd(e,t){const a=new FormData;a.append("image",t),this.$axios.post("/api/upload/image",a,{headers:{"Content-Type":"multipart/form-data"}}).then(t=>{200===t.data.code&&t.data.data&&t.data.data.url?(this.$refs.mdEditor.$img2Url(e,t.data.data.url),this.$message.success("图片上传成功")):(this.$message.error(t.data.msg||"图片上传失败"),this.$refs.mdEditor.$refs.toolbar_left.$imgDel(e))}).catch(t=>{console.error("图片上传错误:",t.response||t),this.$message.error("图片上传请求失败，请检查网络或联系管理员"),this.$refs.mdEditor.$refs.toolbar_left.$imgDel(e)})},handleCategoryChange(e){},submitForm(e){this.$refs[e].validate(e=>{if(!e)return console.log("表单校验失败!!"),this.$message.error("请检查表单填写是否完整且正确"),!1;this.submitLoading=!0,this.$axios.post("/blog/edit",this.ruleForm).then(e=>{200===e.data.code?(this.$message.success(this.ruleForm.id?"博客更新成功！":"博客发布成功！"),this.isAdmin?this.$router.push({name:"AdminBlogManagement"}):this.$router.push({name:"UserPage"})):this.$message.error(e.data.msg||"操作失败")}).catch(e=>{var t;console.error("提交博客失败:",e.response||e),this.$message.error((null===(t=e.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.msg)||"提交失败，请稍后再试")}).finally(()=>{this.submitLoading=!1})})},async handleTagChange(e){const t=e.filter(e=>"string"===typeof e),a=e.filter(e=>"string"!==typeof e);if(t.length>0){const e=t.map(async e=>{try{const t=await this.$axios.post("/tags/create",{name:e});if(200===t.data.code&&t.data.data){const e=t.data.data;return this.tags.find(t=>t.id===e.id)||this.tags.push(e),e.id}return this.$message.error(`创建标签 "${e}" 失败: ${t.data.msg||"未知错误"}`),null}catch(t){return console.error(`创建标签 "${e}" 失败:`,t.response||t),this.$message.error(`创建标签 "${e}" 时发生网络错误`),null}}),s=(await Promise.all(e)).filter(e=>null!==e);this.ruleForm.tagIds=[...a,...s]}else this.ruleForm.tagIds=a},resetForm(e){this.$refs[e].resetFields(),this.ruleForm.id=null,this.ruleForm.categoryIds=[],this.ruleForm.tagIds=[],this.ruleForm.content=""},async getGemmaSuggestions(){if(this.ruleForm.content&&this.ruleForm.content.trim()){this.aiLoading=!0,this.dialogVisible=!0,this.suggestions="";try{const e=await this.$axios.post("/api/ai/ask",{prompt:"请针对以下博客内容提供写作建议、改进点或相关补充信息，使其更完善和吸引人（请直接返回建议内容，不要包含其他额外说明）：\n\n"+this.ruleForm.content});200===e.data.code&&e.data.data?this.suggestions=e.data.data:this.suggestions="获取建议失败: "+(e.data.msg||"AI服务未返回有效建议")}catch(t){var e;console.error("获取AI建议失败:",t.response||t);let a=(null===(e=t.response)||void 0===e||null===(e=e.data)||void 0===e?void 0:e.msg)||t.message||"未知错误";t.message&&t.message.toLowerCase().includes("timeout")&&(a="请求AI服务超时，请稍后再试"),this.suggestions="获取建议失败: "+a}finally{this.aiLoading=!1}}else this.$message.warning("请输入一些内容以获取AI建议")},applySuggestion(){this.suggestions&&!this.suggestions.startsWith("获取建议失败")&&(this.ruleForm.content+="\n\n---\n**AI 建议参考:**\n"+this.suggestions,this.$message.success("建议已添加到编辑区末尾")),this.dialogVisible=!1},async fetchInitialData(){this.pageLoading=!0;try{const[e,t]=await Promise.all([this.$axios.get("/categories"),this.$axios.get("/tags")]);200===e.data.code?this.categories=e.data.data||[]:this.$message.error(e.data.msg||"加载分类列表失败"),200===t.data.code?this.tags=t.data.data||[]:this.$message.error(t.data.msg||"加载标签列表失败");const a=this.$route.params.blogId;if(a){const e=await this.$axios.get("/blog/"+a);if(200===e.data.code&&e.data.data){const t=e.data.data;this.ruleForm={id:t.id,title:t.title||"",description:t.description||"",content:t.content||"",categoryIds:t.categoryIds||(t.categories?t.categories.map(e=>e.id):[]),tagIds:t.tagIds||(t.tags?t.tags.map(e=>e.id):[])}}else this.$message.error(e.data.msg||"加载博客内容失败"),this.$router.push({name:this.isAdmin?"AdminBlogManagement":"UserPage"})}else this.ruleForm={id:null,title:"",description:"",content:"",categoryIds:[],tagIds:[]}}catch(e){console.error("Error during initial data fetch for BlogEdit:",e.response||e),this.$message.error("加载编辑页面初始数据时发生网络错误")}finally{this.pageLoading=!1}}},created(){this.fetchInitialData()}}),P=T,D=(a("1730"),Object(i["a"])(P,L,O,!1,null,"17a46f5e",null)),U=D.exports,B=function(){var e=this,t=e._self._c;return t("div",[t("Header"),!e.loading&&e.blog.id?t("div",{staticClass:"mblog"},[t("h1",[e._v(e._s(e.blog.title))]),t("h2",{staticClass:"blog-description"},[e._v(e._s(e.blog.description))]),t("div",{staticClass:"actions-bar"},[e.canEdit?t("el-link",{staticClass:"action-link",attrs:{icon:"el-icon-edit"}},[t("router-link",{attrs:{to:{name:"BlogEdit",params:{blogId:e.blog.id}}}},[e._v(" 编辑 ")])],1):e._e(),e.canDelete?t("el-link",{staticClass:"action-link",attrs:{icon:"el-icon-delete",type:"danger"},on:{click:e.confirmDeleteBlog}},[e._v(" 删除 ")]):e._e()],1),t("div",{staticClass:"meta-info"},[e.blog.categories&&e.blog.categories.length>0?t("div",{staticClass:"category-box"},[t("span",{staticClass:"meta-title"},[e._v("📂 分类：")]),e._l(e.blog.categories,(function(a){return t("el-tag",{key:"c-"+a.id,staticClass:"meta-tag",attrs:{type:"success"}},[e._v(" "+e._s(a.name)+" ")])}))],2):t("div",{staticClass:"category-box"},[t("span",{staticClass:"meta-title"},[e._v("📂 分类：")]),t("el-tag",{staticClass:"meta-tag",attrs:{type:"info"}},[e._v("暂无分类")])],1),e.blog.tags&&e.blog.tags.length>0?t("div",{staticClass:"tag-box"},[t("span",{staticClass:"meta-title"},[e._v("🏷️ 标签：")]),e._l(e.blog.tags,(function(a){return t("el-tag",{key:"t-"+a.id,staticClass:"meta-tag tag",attrs:{color:a.color||"#409EFF",effect:"dark"}},[e._v(" "+e._s(a.name)+" ")])}))],2):t("div",{staticClass:"tag-box"},[t("span",{staticClass:"meta-title"},[e._v("🏷️ 标签：")]),t("el-tag",{staticClass:"meta-tag",attrs:{type:"info"}},[e._v("暂无标签")])],1)]),t("el-divider"),t("div",{staticClass:"markdown-body",domProps:{innerHTML:e._s(e.blog.content)}})],1):e._e(),e.loading?t("div",{staticClass:"loading-placeholder"},[t("i",{staticClass:"el-icon-loading"}),e._v(" 博客内容加载中... ")]):e._e(),e.loading||e.blog.id?e._e():t("div",{staticClass:"not-found-placeholder"},[t("p",[e._v("未能加载博客内容，或该博客不存在。")]),t("el-button",{attrs:{type:"primary"},on:{click:e.goBack}},[e._v("返回列表")])],1)],1)},q=[],E=a("d4cd"),N=a.n(E),j={name:"BlogDetail",components:{Header:F},data(){return{blog:{id:null,title:"加载中...",description:"",content:"",userId:null,categories:[],tags:[]},loading:!0}},computed:{...Object(_["b"])(["getUser","isAdmin"]),isOwner(){return this.getUser&&this.blog&&this.blog.userId===this.getUser.id},canEdit(){return this.isOwner},canDelete(){return this.isOwner||this.isAdmin}},created(){this.fetchBlogDetail()},watch:{"$route.params.blogId":function(e,t){e&&e!==t&&this.fetchBlogDetail()}},methods:{fetchBlogDetail(){this.loading=!0;const e=this.$route.params.blogId;if(!e)return this.$message.error("无效的博客ID"),this.loading=!1,void this.$router.push({name:"UserPage"});this.$axios.get("/blog/"+e).then(e=>{if(200===e.data.code&&e.data.data){const t=e.data.data;if(this.blog.id=t.id,this.blog.title=t.title||"无标题",this.blog.description=t.description||"",this.blog.userId=t.userId,this.blog.categories=t.categories||[],this.blog.tags=t.tags||[],t.content){const e=new N.a({html:!0,breaks:!0,linkify:!0}),a="http://localhost:8081",s=e.renderer.rules.image;e.renderer.rules.image=(e,t,r,o,i)=>{const n=e[t],l=n.attrIndex("src");let c=n.attrs[l][1];return c&&c.startsWith("/uploads/")&&(n.attrs[l][1]=a+c),s(e,t,r,o,i)},this.blog.content=e.render(t.content)}else this.blog.content="<p style='text-align:center; color:#999;'>暂无内容</p>"}else this.$message.error(e.data.msg||"加载博客详情失败"),this.blog.id=null}).catch(e=>{var t;console.error("加载博客详情请求失败:",e.response||e),this.$message.error((null===(t=e.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.msg)||"加载博客详情时发生网络错误"),this.blog.id=null}).finally(()=>{this.loading=!1})},confirmDeleteBlog(){this.$confirm(`确定要永久删除博客《${this.blog.title}》吗? 此操作不可恢复。`,"警告：删除博客",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning",center:!0}).then(()=>{this.deleteBlog()}).catch(()=>{})},deleteBlog(){this.blog.id&&this.$axios.delete("/blog/"+this.blog.id).then(e=>{200===e.data.code?(this.$message.success("博客删除成功！"),this.isAdmin?this.$router.push({name:"AdminBlogManagement"}):this.$router.push({name:"UserPage"})):this.$message.error(e.data.msg||"删除失败")}).catch(e=>{var t;console.error("删除博客请求失败:",e.response||e),this.$message.error((null===(t=e.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.msg)||"删除博客时发生网络错误")})},goBack(){this.isAdmin?this.$router.push({name:"AdminBlogManagement"}):this.$router.push({name:"UserPage"})}}},z=j,M=(a("746c"),Object(i["a"])(z,B,q,!1,null,"d4b328ae",null)),R=M.exports,K=function(){var e=this,t=e._self._c;return t("div",[t("el-container",[t("el-header",[t("img",{staticClass:"mlogo",attrs:{src:"https://www.markerhub.com/dist/images/logo/markerhub-logo.png",alt:""}})]),t("el-main",[t("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"用户名",prop:"username"}},[t("el-input",{model:{value:e.ruleForm.username,callback:function(t){e.$set(e.ruleForm,"username",t)},expression:"ruleForm.username"}})],1),t("el-form-item",{attrs:{label:"密码",prop:"password"}},[t("el-input",{attrs:{type:"password"},model:{value:e.ruleForm.password,callback:function(t){e.$set(e.ruleForm,"password",t)},expression:"ruleForm.password"}})],1),t("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[t("el-input",{model:{value:e.ruleForm.email,callback:function(t){e.$set(e.ruleForm,"email",t)},expression:"ruleForm.email"}})],1),t("el-form-item",{attrs:{label:"注册身份",prop:"role"}},[t("el-select",{attrs:{placeholder:"请选择身份"},model:{value:e.ruleForm.role,callback:function(t){e.$set(e.ruleForm,"role",t)},expression:"ruleForm.role"}},[t("el-option",{attrs:{label:"普通用户",value:"user"}}),t("el-option",{attrs:{label:"管理员",value:"admin"}})],1)],1),t("el-form-item",{attrs:{label:"头像",prop:"avatar"}},[t("input",{attrs:{type:"file"},on:{change:e.handleFileUpload}})]),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v("注册")]),t("el-button",{on:{click:function(t){return e.resetForm("ruleForm")}}},[e._v("重置")])],1),t("el-form-item",[t("el-link",{attrs:{type:"primary",href:"/login"}},[e._v("已有账号？立即登录")])],1),t("el-form-item",[t("el-button",{on:{click:e.goHome}},[e._v("返回主页")])],1)],1)],1)],1)],1)},H=[],J={name:"Register",data(){return{ruleForm:{username:"",password:"",email:"",role:"user",avatar:null},rules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:15,message:"长度在 3 到 15 个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"邮箱格式不正确",trigger:["blur","change"]}],role:[{required:!0,message:"请选择注册身份",trigger:"change"}]}}},methods:{handleFileUpload(e){this.ruleForm.avatar=e.target.files[0]},submitForm(e){this.$refs[e].validate(e=>{if(!e)return console.log("error submit!!"),!1;{const e=new FormData;e.append("username",this.ruleForm.username),e.append("password",this.ruleForm.password),e.append("email",this.ruleForm.email),e.append("role",this.ruleForm.role),this.ruleForm.avatar&&e.append("avatar",this.ruleForm.avatar),this.$axios.post("/register",e,{headers:{"Content-Type":"multipart/form-data"}}).then(e=>{200===e.data.code?this.$alert("注册成功","提示",{confirmButtonText:"确定",callback:e=>{this.$router.push("/login")}}):this.$message.error(e.data.msg||"注册失败")}).catch(e=>{var t;const a=(null===(t=e.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.msg)||e.message||"注册请求失败";this.$message.error(a)})}})},resetForm(e){this.$refs[e].resetFields(),this.ruleForm.avatar=null,this.ruleForm.role="user";const t=this.$el.querySelector('input[type="file"]');t&&(t.value="")},goHome(){this.$router.push("/")}}},V=J,Q=(a("e792"),Object(i["a"])(V,K,H,!1,null,"6fec3c54",null)),G=Q.exports,W=function(){var e=this,t=e._self._c;return t("div",{staticClass:"admin-dashboard-page"},[t("Header"),t("div",{staticClass:"admin-dashboard-container"},[t("h1",[e._v("管理员控制台")]),e.getUser?t("p",[e._v("欢迎您，管理员 "),t("strong",[e._v(e._s(e.adminUsername))]),e._v("！")]):t("p",[e._v("正在加载用户信息...")]),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{xs:24,sm:12,md:8}},[t("el-card",{staticClass:"dashboard-card",attrs:{shadow:"hover"},nativeOn:{click:function(t){return e.navigateTo({name:"AdminKeywords"})}}},[t("div",{staticClass:"card-content"},[t("i",{staticClass:"el-icon-key card-icon"}),t("h3",[e._v("关键字管理")]),t("p",[e._v("添加、删除和查看内容过滤关键字。")])])])],1),t("el-col",{attrs:{xs:24,sm:12,md:8}},[t("el-card",{staticClass:"dashboard-card",attrs:{shadow:"hover"},nativeOn:{click:function(t){return e.navigateTo({name:"AdminBlogManagement"})}}},[t("div",{staticClass:"card-content"},[t("i",{staticClass:"el-icon-document-copy card-icon",staticStyle:{color:"#E6A23C"}}),t("h3",[e._v("博客管理")]),e._v(" "),t("p",[e._v("查看、搜索和删除所有用户发布的博客。")])])])],1)],1)],1),t("p",{staticStyle:{"text-align":"center",color:"#ccc","margin-top":"20px"}},[e._v("-- 管理仪表盘底部 --")])],1)},X=[],Y={name:"AdminDashboard",components:{Header:F},computed:{...Object(_["b"])(["getUser"]),adminUsername(){return this.getUser?this.getUser.username:"管理员"}},methods:{navigateTo(e){let t=!1;const a=this.$route;"string"===typeof e?t=a.path===e:"object"===typeof e&&null!==e&&(e.name?t=a.name===e.name&&JSON.stringify(a.params)===JSON.stringify(e.params||{})&&JSON.stringify(a.query)===JSON.stringify(e.query||{}):e.path&&(t=a.path===e.path&&JSON.stringify(a.query)===JSON.stringify(e.query||{}))),t?console.log("Already on the target route or navigating to the same route."):this.$router.push(e).catch(e=>{"NavigationDuplicated"!==e.name&&console.error("Router navigation error:",e)})}},created(){console.log("AdminDashboard component created.")},mounted(){console.log("AdminDashboard component mounted.")}},Z=Y,ee=(a("ae4a"),Object(i["a"])(Z,W,X,!1,null,"02116d2b",null)),te=ee.exports,ae=function(){var e=this,t=e._self._c;return t("div",[t("Header"),t("div",{staticClass:"admin-keywords-container"},[t("el-breadcrumb",{staticStyle:{"margin-bottom":"20px"},attrs:{"separator-class":"el-icon-arrow-right"}},[t("el-breadcrumb-item",{attrs:{to:{name:"AdminDashboard"}}},[e._v("管理后台")]),t("el-breadcrumb-item",[e._v("关键字管理")])],1),t("h2",[e._v("关键字管理")]),t("p",[e._v("管理系统中用于内容过滤的违禁词或敏感词汇。")]),t("el-form",{staticClass:"keyword-form",attrs:{inline:!0},nativeOn:{submit:function(t){return t.preventDefault(),e.handleAddKeyword.apply(null,arguments)}}},[t("el-form-item",{attrs:{label:"新关键字"}},[t("el-input",{attrs:{placeholder:"输入违禁词",clearable:""},model:{value:e.newKeywordText,callback:function(t){e.newKeywordText=t},expression:"newKeywordText"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary","native-type":"submit",loading:e.addLoading,icon:"el-icon-plus"}},[e._v("添加")])],1)],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],staticClass:"keywords-table",staticStyle:{width:"100%"},attrs:{data:e.keywordsList,border:"",stripe:"","empty-text":"暂无关键字数据"}},[t("el-table-column",{attrs:{prop:"id",label:"ID",width:"100",align:"center",sortable:""}}),t("el-table-column",{attrs:{prop:"keyword",label:"关键字","min-width":"200","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"created",label:"创建时间",width:"180",align:"center",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.formatDateTime(t.row.created))+" ")]}}])}),t("el-table-column",{attrs:{label:"操作",width:"100",align:"center",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"mini",type:"danger",loading:a.row.deleteLoading,icon:"el-icon-delete",title:"删除关键字"},on:{click:function(t){return e.handleDeleteKeyword(a.row.id,a.row.keyword)}}})]}}])})],1)],1)],1)},se=[],re={components:{Header:F},name:"AdminKeywords",data(){return{newKeywordText:"",keywordsList:[],listLoading:!1,addLoading:!1}},created(){console.log("AdminKeywords component CREATED"),this.fetchKeywords()},methods:{formatDateTime(e){if(!e)return"N/A";try{const t=new Date(e);return isNaN(t.getTime())?"无效日期":t.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})}catch(t){return e}},fetchKeywords(){this.listLoading=!0,this.$axios.get("/admin/keywords/list").then(e=>{200===e.data.code?this.keywordsList=e.data.data.map(e=>({...e,deleteLoading:!1})):this.$message.error(e.data.msg||"获取关键字列表失败")}).catch(e=>{var t;console.error("获取关键字列表请求失败:",e.response||e.message),this.$message.error((null===(t=e.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.msg)||"获取关键字列表请求失败，请检查网络或联系管理员")}).finally(()=>{this.listLoading=!1})},handleAddKeyword(){this.newKeywordText.trim()?(this.addLoading=!0,this.$axios.post("/admin/keywords/add",{keyword:this.newKeywordText.trim()}).then(e=>{200===e.data.code?(this.$message.success("关键字添加成功"),this.newKeywordText="",this.fetchKeywords()):this.$message.error(e.data.msg||"添加关键字失败")}).catch(e=>{var t;console.error("添加关键字请求失败:",e.response||e.message),this.$message.error((null===(t=e.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.msg)||"添加关键字请求失败")}).finally(()=>{this.addLoading=!1})):this.$message.warning("关键字不能为空")},handleDeleteKeyword(e,t){this.$confirm(`确定要永久删除关键字“${t||"此关键字"}”吗?`,"警告：删除关键字",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}).then(()=>{const t=this.keywordsList.findIndex(t=>t.id===e);-1!==t&&this.$set(this.keywordsList[t],"deleteLoading",!0),this.$axios.delete("/admin/keywords/delete/"+e).then(e=>{200===e.data.code?(this.$message.success("关键字删除成功"),this.fetchKeywords()):(this.$message.error(e.data.msg||"删除关键字失败"),-1!==t&&this.$set(this.keywordsList[t],"deleteLoading",!1))}).catch(e=>{var a;console.error("删除关键字请求失败:",e.response||e.message),this.$message.error((null===(a=e.response)||void 0===a||null===(a=a.data)||void 0===a?void 0:a.msg)||"删除关键字请求失败"),-1!==t&&this.$set(this.keywordsList[t],"deleteLoading",!1)})}).catch(()=>{this.$message.info("已取消删除操作")})}}},oe=re,ie=(a("82a3"),Object(i["a"])(oe,ae,se,!1,null,"bff99464",null)),ne=ie.exports,le=function(){var e=this,t=e._self._c;return t("div",{staticClass:"admin-blog-management-page"},[t("Header"),t("div",{staticClass:"page-container"},[t("el-breadcrumb",{staticStyle:{"margin-bottom":"20px"},attrs:{"separator-class":"el-icon-arrow-right"}},[t("el-breadcrumb-item",{attrs:{to:{name:"AdminDashboard"}}},[e._v("管理后台")]),t("el-breadcrumb-item",[e._v("博客管理")])],1),t("h2",[e._v("所有博客列表")]),t("p",[e._v("在这里您可以查看、搜索并管理系统中所有用户发布的博客。")]),t("el-form",{staticClass:"search-form",attrs:{inline:!0,model:e.filters},nativeOn:{submit:function(t){return t.preventDefault(),e.handleSearch.apply(null,arguments)}}},[t("el-form-item",{attrs:{label:"标题搜索"}},[t("el-input",{attrs:{placeholder:"输入博客标题关键字",clearable:""},on:{clear:e.handleSearch},model:{value:e.filters.query,callback:function(t){e.$set(e.filters,"query",t)},expression:"filters.query"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.handleSearch}},[e._v("搜索")]),t("el-button",{attrs:{icon:"el-icon-refresh"},on:{click:e.resetSearch}},[e._v("重置")])],1)],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.blogs,border:"",stripe:"","empty-text":"暂无博客数据"}},[t("el-table-column",{attrs:{prop:"id",label:"ID",width:"80",align:"center",sortable:""}}),t("el-table-column",{attrs:{prop:"title",label:"标题","min-width":"250","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-link",{attrs:{type:"primary",title:"查看博客详情"},on:{click:function(t){return e.viewBlog(a.row.id)}}},[e._v(e._s(a.row.title))])]}}])}),t("el-table-column",{attrs:{label:"作者信息",width:"180"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("div",[e._v("ID: "+e._s(a.row.userId))])]}}])}),t("el-table-column",{attrs:{prop:"created",label:"发布时间",width:"170",align:"center",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.formatDateTime(t.row.created))+" ")]}}])}),t("el-table-column",{attrs:{prop:"status",label:"状态",width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tag",{attrs:{type:0===a.row.status?"success":"info"}},[e._v(" "+e._s(0===a.row.status?"已发布":"草稿")+" ")])]}}])}),t("el-table-column",{attrs:{label:"操作",width:"100",align:"center",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"mini",type:"danger",icon:"el-icon-delete",loading:a.row.deleteLoading,title:"删除博客"},on:{click:function(t){return e.handleDelete(a.row.id,a.row.title)}}})]}}])})],1),e.totalBlogs>0?t("el-pagination",{staticStyle:{"margin-top":"20px","text-align":"right"},attrs:{background:"",layout:"total, sizes, prev, pager, next, jumper","current-page":e.currentPage,"page-size":e.pageSize,"page-sizes":[10,20,50,100],total:e.totalBlogs},on:{"update:currentPage":function(t){e.currentPage=t},"update:current-page":function(t){e.currentPage=t},"update:pageSize":function(t){e.pageSize=t},"update:page-size":function(t){e.pageSize=t},"size-change":e.handleSizeChange,"current-change":e.handlePageChange}}):e._e()],1)],1)},ce=[],de=(a("7d54"),{name:"AdminBlogManagement",components:{Header:F},data(){return{blogs:[],loading:!1,currentPage:1,pageSize:10,totalBlogs:0,filters:{query:""}}},created(){this.fetchBlogs()},methods:{fetchBlogs(){this.loading=!0;const e={currentPage:this.currentPage,pageSize:this.pageSize,query:this.filters.query.trim()};Object.keys(e).forEach(t=>{""!==e[t]&&null!==e[t]&&void 0!==e[t]||delete e[t]}),this.$axios.get("/admin/blogs/all",{params:e}).then(e=>{if(200===e.data.code){const t=e.data.data;this.blogs=t.records.map(e=>({...e,deleteLoading:!1})),this.totalBlogs=t.total}else this.$message.error(e.data.msg||"获取博客列表失败")}).catch(e=>{var t;console.error("获取博客列表失败:",e),this.$message.error((null===(t=e.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.msg)||"请求博客列表失败")}).finally(()=>{this.loading=!1})},formatDateTime(e){if(!e)return"N/A";try{const t=new Date(e);return isNaN(t.getTime())?"无效日期":t.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})}catch(t){return e}},viewBlog(e){this.$router.push({name:"BlogDetail",params:{blogId:e}})},handleDelete(e,t){this.$confirm(`确定要永久删除博客《${t||"此博客"}》吗? 此操作不可恢复。`,"警告：删除博客",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}).then(()=>{const t=this.blogs.findIndex(t=>t.id===e);-1!==t&&this.$set(this.blogs[t],"deleteLoading",!0),this.$axios.delete("/blog/"+e).then(e=>{200===e.data.code?(this.$message.success("博客删除成功"),1===this.blogs.length&&this.currentPage>1&&this.currentPage--,this.fetchBlogs()):this.$message.error(e.data.msg||"删除博客失败")}).catch(e=>{var t;console.error("删除博客请求失败:",e),this.$message.error((null===(t=e.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.msg)||"请求删除博客失败")}).finally(()=>{-1!==t&&this.blogs[t]&&this.$set(this.blogs[t],"deleteLoading",!1)})}).catch(()=>{})},handlePageChange(e){this.currentPage=e,this.fetchBlogs()},handleSizeChange(e){this.pageSize=e,this.currentPage=1,this.fetchBlogs()},handleSearch(){this.currentPage=1,this.fetchBlogs()},resetSearch(){this.filters.query="",this.currentPage=1,this.fetchBlogs()}}}),ue=de,ge=(a("059d"),Object(i["a"])(ue,le,ce,!1,null,"7566826a",null)),me=ge.exports;s["default"].use(d["a"]);const he=[{path:"/",name:"Index",redirect:{name:"UserPage"}},{path:"/user",name:"UserPage",component:A,meta:{requireAuth:!0}},{path:"/login",name:"Login",component:f},{path:"/blog/add",name:"BlogAdd",component:U,meta:{requireAuth:!0}},{path:"/blog/:blogId",name:"BlogDetail",component:R},{path:"/blog/:blogId/edit",name:"BlogEdit",component:U,meta:{requireAuth:!0}},{path:"/register",name:"Register",component:G},{path:"/dashboard",name:"AdminDashboard",component:te,meta:{requireAuth:!0,requireAdmin:!0}},{path:"/admin/keywords",name:"AdminKeywords",component:ne,meta:{requireAuth:!0,requireAdmin:!0}},{path:"/admin/blogs",name:"AdminBlogManagement",component:me,meta:{requireAuth:!0,requireAdmin:!0,title:"博客管理"}}],pe=new d["a"]({mode:"history",base:"/",routes:he});var fe=pe;s["default"].use(_["a"]);var be=new _["a"].Store({state:{token:"",userInfo:JSON.parse(sessionStorage.getItem("userInfo"))},mutations:{SET_TOKEN:(e,t)=>{e.token=t,localStorage.setItem("token",t)},SET_USERINFO:(e,t)=>{e.userInfo=t,sessionStorage.setItem("userInfo",JSON.stringify(t))},REMOVE_INFO:e=>{e.token="",e.userInfo={},localStorage.setItem("token",""),sessionStorage.setItem("userInfo",JSON.stringify(""))}},getters:{getUser:e=>e.userInfo,isAdmin:e=>e.userInfo&&"admin"===e.userInfo.role},actions:{},modules:{}}),ve=a("5c96"),ye=a.n(ve),we=a("bc3a"),_e=a.n(we),$e=a("b2d8"),ke=a.n($e);a("0fae"),a("64e1");_e.a.defaults.baseURL="http://localhost:8081",_e.a.interceptors.request.use(e=>(localStorage.getItem("token")&&(e.headers.Authorization=localStorage.getItem("token")),e),e=>Promise.reject(e)),_e.a.interceptors.response.use(e=>e,e=>(401===e.response.status&&(localStorage.removeItem("token"),fe.push("/login")),Promise.reject(e)),e=>(console.log(e),e.response.data&&(e.message=e.response.data.msg),401===e.response.status&&(be.commit("REMOVE_INFO"),localStorage.removeItem("token"),fe.push("/login")),ye.a.Message.error(e.message,{duration:3e3}),Promise.reject(e)));_e.a,a("a732");fe.beforeEach((e,t,a)=>{console.log(`Navigating from: ${t.path} to: ${e.path}`);const s=be.state.token,r=be.getters.getUser;console.log("Permission Guard Check:",{tokenExists:!!s,userInfo:r,targetPath:e.path,requiresAuth:e.matched.some(e=>e.meta.requireAuth),requiresAdmin:e.matched.some(e=>e.meta.requireAdmin)}),e.matched.some(e=>e.meta.requireAuth)?(console.log("Route requires authentication."),s&&r&&r.id?(console.log("User is authenticated."),e.matched.some(e=>e.meta.requireAdmin)?(console.log("Route requires admin privileges."),"admin"===r.role?(console.log("User is admin. Allowing navigation."),a()):(console.log("User is not admin. Redirecting to UserPage."),ye.a.Message.error("您没有权限访问此页面！"),a({name:"UserPage"}))):(console.log("Route does not require admin. Checking for login page access..."),"Login"===e.name||"Register"===e.name?(console.log("User is logged in and trying to access Login/Register. Redirecting based on role."),a("admin"===r.role?{name:"AdminDashboard"}:{name:"UserPage"})):(console.log("Allowing navigation to non-admin, authenticated route."),a()))):(console.log("User is not authenticated. Redirecting to Login."),be.commit("REMOVE_INFO"),ye.a.Message.warning("请先登录后再访问！"),a({name:"Login",query:{redirect:e.fullPath}}))):(console.log("Route does not require authentication."),("Login"===e.name||"Register"===e.name)&&s&&r&&r.id?(console.log("User is logged in and trying to access public Login/Register. Redirecting based on role."),a("admin"===r.role?{name:"AdminDashboard"}:{name:"UserPage"})):(console.log("Allowing navigation to public route."),a()))}),fe.afterEach((e,t)=>{console.log("Navigation successful to: "+e.path)}),fe.onError(e=>{console.error("Router error:",e)}),s["default"].use(ye.a),s["default"].use(ke.a),s["default"].config.productionTip=!1,s["default"].prototype.$axios=_e.a,new s["default"]({router:fe,store:be,render:e=>e(c)}).$mount("#app")},"6b01":function(e,t,a){"use strict";a("ff3e")},"746c":function(e,t,a){"use strict";a("950d")},"82a3":function(e,t,a){"use strict";a("3765")},8470:function(e,t,a){},"84ab":function(e,t,a){},"8b01":function(e,t,a){},"8b9a":function(e,t,a){"use strict";a("c44d")},"950d":function(e,t,a){},a3e3:function(e,t,a){},ae4a:function(e,t,a){"use strict";a("8470")},c44d:function(e,t,a){},e590:function(e,t,a){},e792:function(e,t,a){"use strict";a("1544")},ff3e:function(e,t,a){}});
//# sourceMappingURL=app.2f72984e.js.map